{% extends "header10.html" %}
{% load static %}

{% block styles %}
<!-- Include Bootstrap CSS for styling -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

<!-- Include DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.dataTables.min.css">

<style>
    /* Styling for sticky header */
    thead th {
        position: sticky;
        top: 0;
        z-index: 100;
        background-color: #f8f9fa;
    }

    /* Adjusting the table for better readability */
    table.dataTable {
        width: 100%;
        margin: 0 auto;
        clear: both;
    }

    /* Enable horizontal scrolling */
    .dataTables_wrapper {
        overflow-x: auto;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-success text-center">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}
    
    <div class="d-flex mb-3">
        <a class="btn btn-primary me-2" href="{% url 'deed' %}">
            <i class="fa fa-plus"></i> Add New Deed
        </a>
        <button id="remove" class="btn btn-danger me-2" title="Delete Farmer">
            <i class="fa fa-trash"></i> Delete Deed
        </button>
        
    </div>
    
    
    
    <div class="card">
        <div class="card-header text-center">My Deeds</div>
        <div class="card-body">
            <table id="order-table" class="table table-striped table-bordered dt-responsive nowrap" data-show-export="true">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" id="select-all">
                        </th>
                        <th>NSSF_No</th>
                        <th>Employer_Name</th>
                        <th>From_Date</th>
                        <th>To_Date</th>
                        <th>Branch</th>
                        <th>Deed_Source</th>
                        <th>Team_Leader</th>
                        <th>Legacy_Status</th>
                        <th>Signed_Deed</th>
                        <th>Status</th>
                        <th></th> <!-- Column for the responsive control -->
                    </tr>
                </thead>
                <tbody>
                    {% for data in deeddata %}
                    <tr>
                        <td>
                            <input type="checkbox" class="record-checkbox">
                        </td>
                        <td>
                            <!-- <a href="rev_eng/{{ data.id }}/" class="text-primary">{{ data.nssf_no }}</a> -->
                            <!-- <a href="deeds/{{ data.id }}/" class="text-primary">{{ data.nssf_no }}</a> -->
                            <a href="{% url 'deeddetail' data.id %}" class="text-primary">{{ data.nssf_no }}</a>

                           
                        </td>
                        <td>{{ data.employer_name|truncatechars:25 }}</td>
                        <td>{{ data.From_Date }}</td>
                        <td>{{ data.To_Date }}</td>
                        <td>{{ data.Branch|truncatechars:25 }}</td>
                        <td>{{ data.Deed_source|truncatechars:25 }}</td>
                        <td>{{ data.team_leader|truncatechars:25 }}</td>
                        <td>{{ data.Legacy_status|yesno:"Yes,No" }}</td>
                        <td>{{ data.Signed_Deed|yesno:"Yes,No" }}</td>
                        <td>{{ data.State }}</td>
                        <td></td> <!-- Cell for the responsive control -->
                    </tr>
                    {% endfor %}
                   
        </div>
    </div>
</div>
{% endblock %}


{% block scripts %}
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script>
    $(document).ready(function() {
        // Custom sorting function for datetime column
        jQuery.extend(jQuery.fn.dataTableExt.oSort, {
            "datetime-pre": function(a) {
                return new Date(a).getTime();
            },

            "datetime-asc": function(a, b) {
                return a - b;
            },

            "datetime-desc": function(a, b) {
                return b - a;
            }
        });

        $('#order-table').DataTable({
            "paging": true,
            "lengthChange": true,
            "searching": true,
            "ordering": true,
            "info": true,
            "autoWidth": false,
            "columnDefs": [
                { "type": "datetime", "targets": 2 } // Set the datetime sorting type for the 'Created at' column
            ],
            "order": [[2, 'desc']] // Specify the column index for ordering (2 for the 'Created at' column)
        });
    });
</script>
{% endblock %}

<script>
    $(document).ready(function() {
        // DataTable initialization
        $('#order-table').DataTable({
            "paging": true,
            "lengthChange": true,
            "searching": true,
            "ordering": true,
            "info": true,
            "autoWidth": false,
            "responsive": {
                details: {
                    type: 'column',
                    target: -1 // Place the toggle at the extreme end
                }
            },
            "scrollX": true, // Enable horizontal scrolling
            "columnDefs": [
                { "type": "datetime", "targets": 3 }, // Adjust column index as needed
                { "className": "control", "orderable": false, "targets": -1 } // Add control class to the last column
            ],
            "order": [[3, 'desc']] // Order by the 'From Date' column
        });

        // Select/Deselect all checkboxes
        $('#select-all').on('click', function() {
            var rows = $('#order-table').DataTable().rows({ 'search': 'applied' }).nodes();
            $('input[type="checkbox"]', rows).prop('checked', this.checked);
        });
    });
</script>





